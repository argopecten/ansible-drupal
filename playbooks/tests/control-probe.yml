# Configures the control servers and prints their context.

- name: Control server context check
  hosts: control
  gather_facts: false
  vars:
    ansible_connection: local
    ansible_python_interpreter: /usr/bin/python3

  tasks:
    - name: Print environment-specific message
      ansible.builtin.debug:
        msg: "Hello, it's the {{ fqdn }} running on {{ hardware }} in the {{ env }} environment!"

    - name: Ping control node quietly
      ansible.builtin.command: >
        ping -c 1 -W {{ ping_timeout | default(5) }} {{ ansible_host | default(inventory_hostname) }}
      register: control_ping
      failed_when: false
      changed_when: false

    - name: Report ping status
      ansible.builtin.debug:
        msg: "{{ inventory_hostname }} ping {{ 'OK' if (control_ping is defined and control_ping.rc == 0) else 'FAILED' }}"
