---
# Create a database user for Drupal sites

# Generate a random password for the Drupal database user
- name: Generate a random MySQL 8-compliant password for the database user
  ansible.builtin.set_fact:
    drupal_db_password: "{{ lookup('ansible.builtin.password',
                      '/dev/null',
                      length=12,
                      chars=['ascii_letters', 'digits', '!+-.:<=>_|']) }}"

# Create database user for site
- name: Create database user for site
  community.mysql.mysql_user:
    check_implicit_admin: true
    login_unix_socket: "{{ mysql_unix_socket }}"
    name: "{{ drupal_db_user }}"
    password: "{{ drupal_db_password }}"
    priv: "*.*:ALL,GRANT"
    host: "{{ drupal_db_host }}"
    state: present
  become: true
