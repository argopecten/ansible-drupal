---
####################################################################################################
# Handlers for server tasks
####################################################################################################

### Common handlers

### Handlers for database tasks
# Restart MySQL
- name: "Restart MySQL"
  ansible.builtin.service:
    name: mysql
    state: restarted


### Handlers for webserver tasks
# Restart Nginx
- name: "Restart Nginx"
  ansible.builtin.service:
    name: nginx
    state: restarted

# Validate Nginx configuration
- name: "Validate nginx configuration"
  ansible.builtin.command: nginx -t -c /etc/nginx/nginx.conf
  changed_when: false

# Reload Nginx
- name: "Reload nginx"
  ansible.builtin.service:
    name: nginx
    state: reloaded
  become: true


### Handlers for php tasks
# Handler to restart PHP-FPM
- name: Restart PHP-FPM
  ansible.builtin.service:
    name: "php{{ php_version }}-fpm"
    state: restarted


### Handlers for SSH tasks
# Restart SSH service
- name: Restart SSH service
  ansible.builtin.service:
    name: ssh
    state: restarted
  become: true
  become_user: "{{ root_user }}"
  when: ansible_os_family == "Debian"

### Handlers for fail2ban tasks
# Restart fail2ban service
- name: Restart fail2ban
  ansible.builtin.service:
    name: fail2ban
    state: restarted
  become: true
  become_user: "{{ root_user }}"
  when: ansible_os_family == "Debian"

### Handlers for firewall tasks
# Reload UFW
- name: Reload UFW
  ansible.builtin.command: ufw reload
  changed_when: false
  become: true
  become_user: "{{ root_user }}"
  when: ansible_os_family == "Debian"
