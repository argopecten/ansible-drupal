---
# Configure journald for service log management.

- name: Ensure journald drop-in directory exists
  ansible.builtin.file:
    path: "{{ logging_journald_config_dir }}"
    state: directory
    owner: "{{ root_user | default('root') }}"
    group: "{{ root_group | default('root') }}"
    mode: "0755"
  become: true
  when: ansible_service_mgr == "systemd"

- name: Ensure journald persistent log directory exists
  ansible.builtin.file:
    path: "{{ logging_journald_persistent_dir }}"
    state: directory
    owner: "{{ root_user | default('root') }}"
    group: "{{ root_group | default('root') }}"
    mode: "{{ logging_journald_persistent_dir_mode }}"
  become: true
  when:
    - ansible_service_mgr == "systemd"
    - logging_journald_storage == "persistent"

- name: Configure journald
  ansible.builtin.template:
    src: "journald.conf.j2"
    dest: "{{ logging_journald_config_file }}"
    owner: "{{ root_user | default('root') }}"
    group: "{{ root_group | default('root') }}"
    mode: "0644"
    force: true
  notify: Restart systemd-journald
  become: true
  when: ansible_service_mgr == "systemd"
