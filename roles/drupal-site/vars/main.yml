---

# Allow write permissions for webserver user for sites/{{ site_dir }} directory
sites_permissions:
  - { name: "Set ownership", cmd: "find {{ drupal_path }}/web/sites/{{ site_dir }} -exec chown {{ drupal_user }}:{{ nginx_user }} '{}' \\+" }
  - { name: "Set directory permissions", cmd: "find {{ drupal_path }}/web/sites/{{ site_dir }} -type d -exec chmod 750 '{}' \\+" }
  - { name: "Set file permissions", cmd: "find {{ drupal_path }}/web/sites/{{ site_dir }} -type f -exec chmod 640 '{}' \\+" }

# Allow write permissions for webserver user for sites/{{ site_dir }}/files directory
sites_permissions:
  - { name: "Set ownership", cmd: "find {{ drupal_path }}/web/sites/{{ site_dir }}/files -exec chown {{ drupal_user }}:{{ nginx_user }} '{}' \\+" }
  - { name: "Set directory permissions", cmd: "find {{ drupal_path }}/web/sites/{{ site_dir }}/files -type d -exec chmod 2775 '{}' \\+" }
  - { name: "Set file permissions", cmd: "find {{ drupal_path }}/web/sites/{{ site_dir }}/files -type f -exec chmod 664 '{}' \\+" }

ansible.builtin.command: >
    chown -R da:www-data /var/www/drupal-{{ drupal_version }}/web/sites/default/files &&
    find /var/www/drupal-{{ drupal_version }}/web/sites/default/files -type d -exec chmod 770 {} \; &&
    find /var/www/drupal-{{ drupal_version }}/web/sites/default/files -type f -exec chmod 660 {} \;
